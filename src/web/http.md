# http

## 描述

规定了浏览器和万维网服务器之间互相通信的规则，通过因特网传送万维网文档的数据传送协议。
主要有GET, POST, HEAD, OPTIONS, PUT, DELETE, TRACE, CONNECT等

### 请求报文

* 请求行
* 请求头
* 空行(发送回车符和换行符，通知服务器以下不再有请求头)
* 请求数据

### 响应报文

* 状态行
* 响应头
* 响应正文

### 状态码

* 1xx 指示信息–表示请求已接收，继续处理
* 2xx 成功–表示请求已被成功接收、理解、接受
* 3xx 重定向–要完成请求必须进行更进一步的操作。
* 4xx 客户端错误–请求有语法错误或请求无法实现。
* 5xx 服务器端错误–服务器未能实现合法的请求。

常见状态码
200---OK/请求已经正常处理完毕

301---/请求永久重定向
302---/请求临时重定向
304---/请求被重定向到客户端本地缓存

400---/客户端请求存在语法错误
401---/客户端请求没有经过授权
403---/客户端的请求被服务器拒绝，一般为客户端没有访问权限
404---/客户端请求的URL在服务端不存在

500---/服务端永久错误
502---/服务主机宕机
503---/服务端发生临时错误
504---/充当网关或代理的服务器，未及时从远端服务器获取请求 
505---/服务器不支持请求中所使用的HTTP协议版本时就回返回此错误，最为常见的是 HTTP/1.1。

## 历史

HTTP/0.9
    HTTP协议的最初版本，功能简单，仅支持请求方式GET，并且仅能请求访问HTML格式的资源。

HTTP/1.0
    在0.9版本上做了进步，增加了请求方式POST和HEAD；不再局限于0.9版本的HTML格式，根据Content-Type可以支持多种数据格式，即MIME多用途互联网邮件扩展，例如text/html、image/jpeg等；同时也开始支持cache，就是当客户端在规定时间内访问统一网站，直接访问cache即可。

    但是1.0版本的工作方式是每次TCP连接只能发送一个请求，当服务器响应后就会关闭这次连接，下一个请求需要再次建立TCP连接，就是不支持keepalive。
HTTP/1.1
    解决了1.0版本的keepalive问题，1.1版本加入了持久连接，一个TCP连接可以允许多个HTTP请求； 加入了管道机制，一个TCP连接同时允许多个请求同时发送，增加了并发性；新增了请求方式PUT、PATCH、DELETE等。

    但是还存在一些问题，服务端是按队列顺序处理请求的，假如一个请求处理时间很长，则会导致后边的请求无法处理，这样就造成了队头阻塞的问题；同时HTTP是无状态的连接，因此每次请求都需要添加重复的字段，降低了带宽的利用率。
HTTP/2.0
    为了解决1.1版本利用率不高的问题，提出了HTTP/2.0版本。增加双工模式，即不仅客户端能够同时发送多个请求，服务端也能同时处理多个请求，解决了队头堵塞的问题；HTTP请求和响应中，状态行和请求/响应头都是些信息字段，并没有真正的数据，因此在2.0版本中将所有的信息字段建立一张表，为表中的每个字段建立索引，客户端和服务端共同使用这个表，他们之间就以索引号来表示信息字段，这样就避免了1.0旧版本的重复繁琐的字段，并以压缩的方式传输，提高利用率。

    另外也增加服务器推送的功能，即不经请求服务端主动向客户端发送数据。

## http和https协议的区别

https以安全为目标的HTTP，简单讲是HTTP的安全版，传输层加入了SSL(TLS)

申请CA证书，Lets'sScrypt

HTTPS同时需要对称加密算法和非对称加密算法

## http1.0

* 使用短连接进行传输
* 数据基于文本传输，换行符分隔

## http1.1

* 增加`host`头部
* 使用长连接，增加 `Connection: keep-alive`
* 基于pipeline进行传输

### 问题

* 请求是一个个返回的，队头阻塞，大量的请求延迟很高
* 浏览器会限制网站的连接数量，大量的请求加载慢

## http2.0

* 二进制帧传输
* 多路复用，流式传输，使用stream表示每个请求，请求互相之间不影响
* 优先级
* 头部压缩
* 服务端主动推送
