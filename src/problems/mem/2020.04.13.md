# 内存泄漏

## 现象

服务器的内存报警，重启服务报警恢复

## 分析

大脑中出现了如下2个方向的排查思路

1. 内存结构使用不合理
2. Goroutinue泄漏

查看系统监控发现内存一直在涨，Goroutinue数量也一直在涨，最近服务发布的次数间隔时间久， 很快确定了是goroutine泄露

由于看代码的话，不一定很快发现问题，刚好想使用pprof工具发现问题

使用pprof进行采样，得到svg图片，发现大量的Goroutinue都是发送kafka产生的，且持续增加

## 原因

由于业务方和基础架构对kafka使用沟通的误区，业务代码进行异步发送后，协程阻塞等待，导致Goroutinue持续增长

## 解决方案

进行正确的配置，业务代码取消阻塞等待
