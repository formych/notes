# Redis

## 现象

业务请求redis一直报错timeout, 导致大量报警

## 分析

查看兼容是否有慢日志

查看监控图redis的QPS，命令处理耗时

使用`ss -s`查看服务器的连接数，发现有大量TIME_WAIT, 套接字总数默认是10240，当前的一旦超了10240报警就开始了

`ss -tpan`查看具体的端口情况

发现跟redis的连接有大量的TIME_WAIT, 等待回收

## 原因

确认是redis的配置问题，最大连接数比较大，最大空闲连接数过少导致， 空闲时间比较短

当业务有高峰时，不断新建连接数，空闲回收导致socket不够使用，go里面返回错误，框架统一当做timeout处理
